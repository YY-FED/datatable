!function(e){"use strict";var t=!0,a={toString:1};for(var n in a)t=null;t&&(t=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"]);var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},h=function(e,a){var n,r=arguments;if(r.length>1)for(var i=1;i<r.length;i++)if(n=r[i],e&&n&&"object"===(void 0===n?"undefined":s(n))){var o,l,u;for(o in n)e[o]=n[o];if(t)for(l=t.length;l--;)u=t[l],n.hasOwnProperty&&n.hasOwnProperty(u)&&(e[u]=n[u])}return e};Object.assign||(Object.assign=h);var c=function(e,t){this.copyRows(e,[t])},d=function(e,t){for(var a=0;a<t.length;a++){var n=new Row({parent:this});t[a]&&n.setData(t[a].getData()),this.insertRows(void 0===e?this.rows().length:e,[n])}},g={copyRow:c,copyRows:d},f=function(e,t){if(e.pageIndex||0===e.pageIndex)var a=e.pageIndex;else var a=this.pageIndex();if(e.pageSize||0===e.pageSize)var n=e.pageSize;else var n=this.pageSize();if(e.totalPages||0===e.totalPages)var s=e.totalPages;else var s=this.totalPages();if(e.totalRow||0===e.totalRow)var r=e.totalRow;else if(e.rows)var r=e.rows.length;else var r=this.totalRow();var i,o,l=!!t&&t.unSelect;if(this.pageIndex(a),this.pageSize(n),this.pageCache=e.pageCache||this.pageCache,!0===this.pageCache){if(this.updatePages(e.pages),a!=this.pageIndex())return this.setCurrentPage(a,!0),this.totalPages(s),void this.totalRow(r+this.newCount);this.removeAllRows(),i=this.getPage(a).selectedIndices,o=this.getPage(a).focus;var u=this.setRows(this.getPage(a).rows,t);this.getPage(a).rows=u,e.totalPages&&this.totalPages(e.totalPages),(e.totalRow||0===e.totalRow)&&this.totalRow(e.totalRow+this.newCount)}else i=e.select||(l?[]:[0]),o=void 0!==e.focus?e.focus:e.current,this.setRows(e.rows,t),this.totalPages(s),this.totalRow(r);this.updateSelectedIndices(),i&&i.length>0&&this.rows().length>0&&this.setRowsSelect(i),void 0!==o&&this.getRow(o)&&this.setRowFocus(o)},w=function(e,t,a,n){1===arguments.length&&(t=e,e="$data"),(a=a||this.getCurrentRow())&&a.setValue(e,t,n)},v=function(){for(var e=this.rows(),t=0;t<e.length;t++){var a=e[t];if(a.status==Row.STATUS.NEW)this.setRowsDelete(a);else if(a.status==Row.STATUS.FALSE_DELETE){a.status=Row.STATUS.NORMAL;var e=[a];this.trigger(DataTable.ON_INSERT,{index:0,rows:e})}else a.status==Row.STATUS.UPDATE&&(a.status=Row.STATUS.NORMAL,e[t].resetValue())}},p=function(e){if(e.status==Row.STATUS.NEW)this.setRowsDelete(e);else if(e.status==Row.STATUS.FALSE_DELETE){e.status=Row.STATUS.NORMAL;var t=[e];this.trigger(DataTable.ON_INSERT,{index:0,rows:t})}else e.status==Row.STATUS.UPDATE&&(e.status=Row.STATUS.NORMAL,t[i].resetValue())},R={setData:f,setValue:w,resetAllValue:v,resetValueByRow:p},m=function(e){var t=this.getMeta(e,"enable");return void 0!==t&&null!=t||(t=!0),t&&this.enable},S=function(e){this.enable!=e&&(e=!1!==e,this.enable=e,this.enableChange(-this.enableChange()),this.trigger(DataTable.ON_ENABLE_CHANGE,{enable:this.enable}))},T={isEnable:m,setEnable:S},_=function(){if(-1!=this.focusIndex())return this.getFocusRow();var e=this.getSelectedIndex();return-1==e?null:this.getRow(e)},C=function(){if(-1!=this.focusIndex())return this.focusIndex();var e=this.getSelectedIndex();return-1==e?-1:e},I={getCurrentRow:_,getCurrentIndex:C},b=function(){for(var e=[],t=this.rows(),a=0;a<t.length;a++)e.push(t[a].getData());return e},D=function(e,t){var a={};return a.focus=e.focus,a.index=t,a.select=e.selectedIndices,a},E=function(e){var t,a={},n=null;if(a.meta=this.meta,a.params=this.params,e=e||DataTable.SUBMIT.current,this.pageCache){var s=this.getPages();if(e==DataTable.SUBMIT.current||e==DataTable.SUBMIT.focus){n=[];var r=this.pageIndex(),i=s[r];if(i){var o=this.focusIndex();e==DataTable.SUBMIT.current&&-1==o&&(o=this.getSelectedIndex());var l=D(i,r);l.rows=[];for(var u=0,h=i.rows.length;u<h;u++){var c=i.rows[u].getData();u!=o&&(c.data={}),l.rows.push(c)}n.push(l)}}else if(e==DataTable.SUBMIT.all||e==DataTable.SUBMIT.allPages){n=[];for(var u=0;u<s.length;u++){var i=s[u],l=D(i,u);l.rows=[];for(var u=0;u<i.rows.length;u++)l.rows.push(i.rows[u].getData());n.push(l)}}else if(e==DataTable.SUBMIT.select){n=[];var r=this.pageIndex(),i=s[r];if(i){var l=D(i,r);l.rows=[];for(var u=0,h=i.rows.length;u<h;u++){var c=i.rows[u].getData();l.select.indexOf(u)<0&&(c.data={}),l.rows.push(c)}n.push(l)}}else if(e==DataTable.SUBMIT.allSelect){n=[];for(var u=0;u<s.length;u++){var i=s[u],l=D(i,u);l.rows=[];for(var d=0,h=i.rows.length;d<h;d++){var c=i.rows[d].getData();l.select.indexOf(d)<0&&(c.data={}),l.rows.push(c)}n.push(l)}}else if(e==DataTable.SUBMIT.change){n=[];for(var u=0;u<s.length;u++){var i=s[u],l=D(i,u);l.rows=[];for(var d=0,h=i.rows.length;d<h;d++){var c=i.rows[d].getData();c.status==Row.STATUS.NORMAL&&(c.data={}),l.rows.push(c)}n.push(l)}}else e===DataTable.SUBMIT.empty&&(n=[]);(s.length<1||!s[this.pageIndex()])&&(n=[{index:this.pageIndex(),select:[],focus:-1,rows:[]}]),a.pages=n}else{if(e==DataTable.SUBMIT.current){n=[];var o=this.focusIndex();-1==o&&(o=this.getSelectedIndex()),t=this.rows();for(var u=0,h=t.length;u<h;u++)u==o?n.push(t[u].getData()):n.push(t[u].getEmptyData())}else if(e==DataTable.SUBMIT.focus){n=[],t=this.rows();for(var u=0,h=t.length;u<h;u++)u==this.focusIndex()?n.push(t[u].getData()):n.push(t[u].getEmptyData())}else e==DataTable.SUBMIT.all?n=this.getData():e==DataTable.SUBMIT.select?n=this.getSelectedDatas(!0):e==DataTable.SUBMIT.change?n=this.getChangedDatas():e===DataTable.SUBMIT.empty&&(n=[]);a.rows=n,a.select=this.getSelectedIndexs(),a.focus=this.getFocusIndex()}return a.pageSize=this.pageSize(),a.pageIndex=this.pageIndex(),a.isChanged=this.isChanged(),a.master=this.master,a.pageCache=this.pageCache,a},y=function(e){return this.rows.peek()[e]},A=function(e){var t=e.fullField,a=e.index,n=null;if(parseInt(a)>-1)if((a+"").indexOf(".")>0){for(var s=t.split("."),r=a.split("."),i=this,o=null,l=0;l<r.length;l++)if(o=i.getRow(r[l]),l<r.length-1){if(!o){o=null;break}i=o.getValue(s[l])}n=o}else n=this.getRow(a);return n},O=function(e){for(var t=this.rows.peek(),a=0,n=t.length;a<n;a++)if(t[a].rowId==e)return t[a];return null},x=function(e){for(var t=this.rows.peek(),a=0,n=t.length;a<n;a++)if(t[a].rowId===e.rowId)return a;return-1},N=function(e,t){for(var a=this.rows.peek(),n=new Array,s=0,r=a.length;s<r;s++)a[s].getValue(e)===t&&n.push(a[s]);return n},M=function(e,t){for(var a=this.rows.peek(),n=0,s=a.length;n<s;n++)if(a[n].getValue(e)===t)return a[n];return null},U=function(){return this.rows.peek()},P=function(){for(var e,t=[],a=0;a<this.totalPages();a++){if(e=[],a==this.pageIndex())e=this.getData();else{var n=this.cachedPages[a];n&&(e=n.getData())}for(var s=0;s<e.length;s++)t.push(e[s])}return t},L=function(e){for(var t=[],a=this.rows(),n=0,s=a.length;n<s;n++)a[n]&&a[n].status!=Row.STATUS.NORMAL?t.push(a[n].getData()):1==e&&t.push(a[n].getEmptyData());return t},F=function(){for(var e=[],t=this.rows.peek(),a=0,n=t.length;a<n;a++)t[a]&&t[a].status!=Row.STATUS.NORMAL&&e.push(t[a]);return e},j=function(){for(var e=[],t=this.rows.peek(),a=0,n=t.length;a<n;a++)t[a]&&t[a].status==Row.STATUS.FALSE_DELETE&&e.push(t[a]);return e},k=function(e,t){return t=t||this.getCurrentRow(),t?t.getValue(e):""},V=function(e){for(var t=this.rows(),a=0,n=t.length;a<n;a++)if(t[a].rowId==e)return a;return-1},B=function(){for(var e=this.getAllRows(),t=[],a=0,n=e.length;a<n;a++)e[a]&&t.push(e[a].getData());return t},H=function(e){for(var t=[],a=0;a<e.length;a++)t.push(this.getRow(e[a]).rowId);return t},W=function(e){for(var t=[],a=0;a<e.length;a++)t.push(this.getRow(e[a]));return t},z={getData:b,getDataByRule:E,getRow:y,getChildRow:A,getRowByRowId:O,getRowIndex:x,getRowsByField:N,getRowByField:M,getAllRows:U,getAllPageRows:P,getChangedDatas:L,getChangedRows:F,getDeleteRows:j,getValue:k,getIndexByRowId:V,getAllDatas:B,getRowIdsByIndices:H,getRowsByIndices:W},Y=function(){return-1!=this.focusIndex()?this.getRow(this.focusIndex()):null},G=function(){return this.focusIndex()},Z={getFocusRow:Y,getFocusIndex:G},J=function(e,t){return 0===arguments.length?this.meta:1===arguments.length?this.meta[e]:this.meta[e]&&void 0!==this.meta[e][t]?this.meta[e][t]:null},q=function(e,t){var a=this.getCurrentRow();return a?a.getMeta(e,t):this.getMeta(e,t)},$={getMeta:J,getRowMeta:q},X=function(e){return this.pageCache?this.cachedPages[e]:-1},Q=function(){return this.pageCache?this.cachedPages:[]},K={getPage:X,getPages:Q},ee=function(e){return this.params[e]},te={getParam:ee},ae=function(){var e=this.selectedIndices();return null==e||0==e.length?-1:e[0]},ne=function(){var e=this.selectedIndices();return null==e||0==e.length?[]:e},se=function(){return this.getSelectedIndices()},re=function(e){for(var t=this.selectedIndices(),a=[],n=[],s=0,r=t.length;s<r;s++)n.push(t[s]);for(var i=this.rows(),s=0,r=i.length;s<r;s++)-1!=n.indexOf(s)?a.push(i[s].getData()):1==e&&a.push(i[s].getEmptyData());return a},ie=function(){for(var e=this.selectedIndices(),t=[],a=this.rows.peek(),n=[],s=0,r=e.length;s<r;s++)n.push(e[s]);for(var s=0,r=a.length;s<r;s++)-1!=n.indexOf(s)&&t.push(a[s]);return t},oe={getSelectedIndex:ae,getSelectedIndices:ne,getSelectedIndexs:se,getSelectedDatas:re,getSelectedRows:ie},le=function(e){e=e||{};var t,a=[],n=e.type||"all",s=e.fields||null;if("all"===n)t=this.rows.peek();else if("current"===n){var r=this.getCurrentRow();t=null==r?[]:[r]}else if("focus"===n){var i=this.getFocusRow();t=null==i?[]:[i]}else"select"===n?t=this.getSelectedRows():"change"===n&&(t=this.getChangedRows());for(var o=0;o<t.length;o++)a.push(t[o].getSimpleData({fields:s}));return 0==a.length&&(a=this.setSimpleDataReal),a},ue={getSimpleData:le},he=function(e,t,a){if(this.meta[e]){var n=this.meta[e][t],s=this.getCurrentRow();this.meta[e][t]=a,this.metaChange[e+"."+t]&&this.metaChange[e+"."+t](-this.metaChange[e+"."+t]()),"enable"==t&&this.enableChange(-this.enableChange()),this.trigger(DataTable.ON_META_CHANGE,{eventType:"dataTableEvent",dataTable:this.id,field:e,meta:t,oldValue:n,newValue:a}),s&&!s.getMeta(e,t,!1)&&this.trigger(e+"."+t+"."+DataTable.ON_CURRENT_META_CHANGE,{eventType:"dataTableEvent",dataTable:this.id,oldValue:n,newValue:a})}},ce=function(e){if(e)for(var t in e)for(var a in e[t]){var n=this.meta[t][a],s=e[t][a];"default"===a?(this.meta[t].default||(this.meta[t].default={}),this.meta[t].default.value=e[t][a]):"display"===a?(this.meta[t].default||(this.meta[t].default={}),this.meta[t].default.display=e[t][a]):this.meta[t][a]=e[t][a],this.metaChange[t+"."+a]&&this.metaChange[t+"."+a](-this.metaChange[t+"."+a]()),this.trigger(DataTable.ON_META_CHANGE,{eventType:"dataTableEvent",dataTable:this.id,field:t,meta:a,oldValue:n,newValue:s})}},de=function(e,t){if(1!=this.root.strict){if(-1!=e.indexOf("."))for(var a=e.split("."),n=a[0],r=0,i=a.length;r<i;r++){if(this.meta[n]&&"child"===this.meta[n].type)return;r+1<i&&(n=n+"."+a[r+1])}if(this.meta[e]||(this.meta[e]={}),"object"===(void 0===t?"undefined":s(t)))if(t.meta)for(var o in t.meta)this.meta[e].meta[o]=t.meta[o];else for(var o in t)this.meta[e][o]=t[o];if(this.root!==this){for(var l=this.ns.split("."),u=this.root.meta,r=0;r<l.length;r++)u[l[r]]=u[l[r]]||{},u[l[r]].type=u[l[r]].type||"child",u[l[r]].meta=u[l[r]].meta||{},u=u[l[r]].meta;if(u[e]||(u[e]={}),"object"===(void 0===t?"undefined":s(t)))for(var o in t)u[e][o]||(u[e][o]=t[o])}}},ge={setMeta:he,updateMeta:ce,createField:de},fe=function(e,t){var a=this.totalRow();e!=this.pageIndex()&&1!=t&&this.cacheCurrentPage(),this.pageIndex(e);var n=this.cachedPages[this.pageIndex()];if(n){var s=n.selectedIndices;this.removeAllRows(),this.setRows(n.rows),this.setRowsSelect(s)}this.totalRow(a)},we=function(e){var t,a,n,t,s,r,i,o,l,u,n;this.pageSize();for(r=0;r<e.length;r++)if(s=e[r].index,i=e[r].rows,o=e[r].current,l=e[r].select,"del"!==e[r].status)if(this.cachedPages[s]){t=this.cachedPages[s],t.selectedIndices=l,t.focus=o;for(var u=0;u<i.length;u++)if(a=i[u],a.id||(a.id=Row.getRandomRowId()),a.status==Row.STATUS.DELETE){var n=t.getRowByRowId(a.id);if(n){var h=this.totalRow(),c=h-1;this.totalRow(c),n.status==Row.STATUS.NEW&&(this.newCount-=1,this.newCount<0&&(this.newCount=0))}this.removeRowByRowId(a.id),t.removeRowByRowId(a.id)}else if(n=t.getRowByRowId(a.id))t.updateRow(n,a),n.status==Row.STATUS.NEW&&a.status!=Row.STATUS.NEW&&(this.newCount-=1,this.newCount<0&&(this.newCount=0)),n.setStatus(Row.STATUS.NORMAL),a.status==Row.STATUS.NEW&&n.setStatus(Row.STATUS.NEW);else{a.rowId=a.id,delete a.id,t.rows.push(a),a.status!=Row.STATUS.NEW?n.setStatus(Row.STATUS.NORMAL):this.newCount+=1;var h=this.totalRow(),c=h+1;this.totalRow(c)}}else{t=new Page({parent:this}),t.rows=i;for(var u=0;u<t.rows.length;u++)t.rows[u].rowId=t.rows[u].id,delete t.rows[u].id;this.cachedPages[s]=t,t.selectedIndices=l,t.focus=o}else this.cachedPages[s]=null},ve=function(e){var t,a=this.pageSize(),n=0;this.cachedPages=[];for(var s=0;s<e.length;s++)n=Math.floor(s/a),this.cachedPages[n]||(t=new Page({parent:this}),this.cachedPages[n]=t),t.rows.push(e[s]);this.pageIndex()>-1&&this.setCurrentPage(this.pageIndex()),this.totalRow(e.length),this.totalPages(n+1)},pe=function(e){return!(!this.pageCache||!this.cachedPages[e])},Re=function(){this.cachedPages=[]},me=function(){if(this.pageCache&&this.pageIndex()>-1){var e=new Page({parent:this});e.focus=this.getFocusIndex(),e.selectedIndices=this.selectedIndices().slice();for(var t=this.rows.peek(),a=0;a<t.length;a++){var n=t[a].getData();n.rowId=n.id,delete n.id,e.rows.push(n)}this.cachedPages[this.pageIndex()]=e}},Se=function(){for(var e=this.getSelectedRows(),t=this.getPages(),a=0;a<t.length;a++){for(var n=t[a].rows,s=[],r=0;r<e.length;r++)for(var i=e[r],o=0;o<n.length;o++){var l=n[o];if(i==l){s.push(o);break}}t[a].selectedIndices=s}},Te=function(){if(this.pageCache){var e=this.pageIndex(),t=this.getPages()[e];t&&(t.rows=this.rows())}},_e=function(){if(this.pageCache){var e=this.pageIndex(),t=this.getPages()[e];if(t){var a=this.selectedIndices().slice();t.selectedIndices=a}}},Ce=function(){if(this.pageCache){var e=this.pageIndex(),t=this.getPages()[e];t&&(t.focus=this.getFocusIndex())}},Ie=function(){this.updatePageRows(),this.updatePageSelect(),this.updatePageFocus()},be={setCurrentPage:fe,updatePages:we,setPages:ve,hasPage:pe,clearCache:Re,cacheCurrentPage:me,updatePagesSelect:Se,updatePageRows:Te,updatePageSelect:_e,updatePageFocus:Ce,updatePageAll:Ie},De=function(e,t){this.params[e]=t},Ee=function(e){for(var t in e)this.params[t]=e[t]},ye={addParam:De,addParams:Ee},Ae=function(){return ko.pureComputed({read:function(){for(var e=this.selectedIndices()||[],t=this.rows(),a=[],n=0;n<e.length;n++)a.push(t[n]);return a},owner:this})},Oe=function(e){return this.createField(e),this.valueChange[e]||(this.valueChange[e]=ko.observable(1)),ko.pureComputed({read:function(){this.valueChange[e](),this.currentRowChange();var t=this.getCurrentRow();return t?t.getChildValue(e):""},write:function(t){var a=this.getCurrentRow();a&&a.setChildValue(e,t)},owner:this})},xe=function(e,t){return this.metaChange[e+"."+t]||(this.metaChange[e+"."+t]=ko.observable(1)),ko.pureComputed({read:function(){return this.metaChange[e+"."+t](),this.currentRowChange(),this.getMeta(e,t)},write:function(a){this.setMeta(e,t,a)},owner:this})},Ne=function(e,t){return this.metaChange[e+"."+t]||(this.metaChange[e+"."+t]=ko.observable(1)),ko.pureComputed({read:function(){this.metaChange[e+"."+t](),this.currentRowChange();var a=this.getCurrentRow();return a?a.getMeta(e,t):this.getMeta(e,t)},write:function(t){var a=this.getCurrentRow();a&&a.setMeta(e,t)},owner:this})},Me=function(e){return ko.pureComputed({read:function(){if(this.enableChange(),!e)return this.enable;var t=this.getRowMeta(e,"enable");return void 0!==t&&null!=t||(t=!0),t&&this.enable},owner:this})},Ue={refSelectedRows:Ae,ref:Oe,refMeta:xe,refRowMeta:Ne,refEnable:Me},Pe=function(e){var t=function(){};return t.prototype=e,new t},Le=function(e,t){if(t){if("object"==(void 0===t?"undefined":s(t)))return t;for(var a=t.split("."),n=e,r=0;r<a.length;r++)if(!(n=n[a[r]]))return null;return n}},Fe=function(e){return e-parseFloat(e)+1>=0},je=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},ke=function(e){var t;for(t in e)return!1;return!0};try{NodeList.prototype.forEach=Array.prototype.forEach}catch(e){}String.prototype.lengthb=function(){return this.replace(/[^\x00-\xff]/g,"**").length},String.prototype.replaceAll=function(e,t){var a=new RegExp(e,"g");return this.replace(a,t)};var Ve=function(e){if("string"!=typeof e)return e;if(e&&e.indexOf("-")>-1){/iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase())&&(e=e.replace(/-/g,"/"),e=e.replace(/(^\s+)|(\s+$)/g,""),e.length<=8&&(e=e+="/01"))}return e},Be=function(){for(var e=this.getAllRows(),t=0;t<e.length;t++)if(e[t].status!=Row.STATUS.NORMAL)return!0;return!1},He=function(e,t){if("string"==typeof t||"number"==typeof t)t=[t];else if(t instanceof Row)t=[e.getIndexByRowId(t.rowId)];else if(je(t)&&t.length>0&&t[0]instanceof Row)for(var a=0;a<t.length;a++)t[a]=e.getIndexByRowId(t[a].rowId);return t},We={isChanged:Be,_formatToIndicesArray:He},ze=function(e){var t=this.getIndexByRowId(e);-1!=t&&this.removeRow(t)},Ye=function(e){e instanceof Row&&(e=this.getIndexByRowId(e.rowId)),this.removeRows([e])},Ge=function(){this.rows([]),this.selectedIndices([]),this.focusIndex(-1),this.trigger(DataTable.ON_DELETE_ALL),this.updateCurrIndex()},Ze=function(e){this.setRowsDelete(e)},Je=function(){this.removeAllRows(),this.cachedPages=[],this.totalPages(1),this.pageIndex(0),this.focusIndex(-1),this.selectedIndices([])},qe={removeRowByRowId:ze,removeRow:Ye,removeAllRows:Ge,removeRows:Ze,clear:Je},$e=function(e,t){for(var a,n=[],s=0;s<e.length;s++){var r=e[s];if(a=r.rowId||r.id,a||(a=Row.getRandomRowId()),r.status==Row.STATUS.DELETE)this.removeRowByRowId(a);else{var i=this.getRowByRowId(a);i?(i.updateRow(r),ke(r.data)||(this.trigger(DataTable.ON_UPDATE,{index:s,rows:[i]}),i==this.getCurrentRow()?(this.currentRowChange(-this.currentRowChange()),i.currentRowChange(-i.currentRowChange()),this.trigger(DataTable.ON_CURRENT_UPDATE,{index:s,rows:[i]})):i.currentRowChange(-i.currentRowChange()))):(i=new Row({parent:this,id:a}),i.setData(e[s],null,t),n.push(i)),r.status&&i.setStatus(r.status)}}return n.length>0&&this.addRows(n),n},Xe=function(e){this.insertRow(this.rows().length,e),this.resetDelRowEnd()},Qe=function(){for(var e=this.rows().length-1;e>-1;e--){var t=this.rows()[e];t.status!=Row.STATUS.DELETE&&t.status!=Row.STATUS.FALSE_DELETE||(this.rows().splice(e,1),this.rows().push(t))}},Ke=function(e){this.insertRows(this.rows().length,e),this.resetDelRowEnd()},et=function(e,t){t||(t=new Row({parent:this})),this.insertRows(e,[t])},tt=function(e,t){for(var a=[e,0],n=0;n<t.length;n++)a.push(t[n]);this.rows.splice.apply(this.rows,a),this.updateSelectedIndices(e,"+",t.length),this.updateFocusIndex(e,"+",t.length),this.updatePageAll(),this.trigger(DataTable.ON_INSERT,{index:e,rows:t}),this.ns&&this.root.valueChange[this.ns]&&this.root.valueChange[this.ns](-this.root.valueChange[this.ns]())},at=function(e){var t=new Row({parent:this});return this.addRow(t),!!e&&e.unSelect||this.getCurrentRow()||this.setRowSelect(t),t},nt={setRows:$e,addRow:Xe,addRows:Ke,insertRow:et,insertRows:tt,createEmptyRow:at,resetDelRowEnd:Qe},st=function(){var e=-1!=this.focusIndex()?this.focusIndex():this.getSelectedIndex();this._oldCurrentIndex!=e&&(this._oldCurrentIndex=e,this.trigger(DataTable.ON_CURRENT_ROW_CHANGE),this.currentRowChange(-this.currentRowChange()),this.ns&&this.root.valueChange[this.ns]&&this.root.valueChange[this.ns](-this.root.valueChange[this.ns]()))},rt={updateCurrIndex:st},it=function(e){e instanceof Row&&(e=this.getIndexByRowId(e.rowId)),this.setRowsDelete([e])},ot=function(){for(var e=new Array(this.rows().length),t=0;t<e.length;t++)e[t]=t;this.setRowsDelete(e)},lt=function(e){e=We._formatToIndicesArray(this,e),e=e.sort(function(e,t){return t-e});for(var t=this.getRowIdsByIndices(e),a=this.getRowsByIndices(e),n=0;n<e.length;n++){var s=this.getRow(e[n]);if(s.status==Row.STATUS.NEW)this.rows().splice(e[n],1);else{s.setStatus(Row.STATUS.FALSE_DELETE);var r=this.rows().splice(e[n],1);this.rows().push(r[0])}this.updateSelectedIndices(e[n],"-"),this.updateFocusIndex(e[n],"-")}this.updateCurrIndex(),this.trigger(DataTable.ON_DELETE,{falseDelete:!0,indices:e,rowIds:t,rows:a})},ut={setRowDelete:it,setAllRowsDelete:ot,setRowsDelete:lt},ht=function(){for(var e=new Array(this.rows().length),t=0;t<e.length;t++)e[t]=t;this.setRowsSelect(e),this.allSelected(!0),this.trigger(DataTable.ON_ROW_ALLSELECT,{})},ct=function(e){e instanceof Row&&(e=this.getIndexByRowId(e.rowId)),this.setRowsSelect([e]),this.setRowFocus(this.getSelectedIndex())},dt=function(e){if(-1==(e=e||-1))return void this.setAllRowsUnSelect({quiet:!0});e=We._formatToIndicesArray(this,e);var t=this.selectedIndices();if(!je(e)||!je(t)||e.join()!=t.join()){if(je(e))for(var a=this.rows().length,n=0;n<e.length;n++)(e[n]<0||e[n]>=a)&&e.splice(n,1);this.setAllRowsUnSelect({quiet:!0});try{this.selectedIndices(e)}catch(e){}this.updatePageSelect();var s=this.getRowIdsByIndices(e);this.currentRowChange(-this.currentRowChange()),this.trigger(DataTable.ON_ROW_SELECT,{indices:e,rowIds:s}),this.updateCurrIndex()}},gt=function(e){e instanceof Row&&(e=this.getIndexByRowId(e.rowId)),this.addRowsSelect([e])},ft=function(e){e=We._formatToIndicesArray(this,e);for(var t=this.selectedIndices().slice(),a=!1,n=0;n<e.length;n++){for(var s=e[n],r=!0,i=0;i<t.length;i++)t[i]==s&&(r=!1);r&&e[n]>-1&&(a=!0,t.push(e[n]))}this.selectedIndices(t),this.updatePageSelect();var o=this.getRowIdsByIndices(t);a&&this.trigger(DataTable.ON_ROW_SELECT,{indices:t,rowIds:o}),this.updateCurrIndex()},wt=function(e){this.selectedIndices([]),this.updatePageSelect(),e&&e.quiet||this.trigger(DataTable.ON_ROW_ALLUNSELECT),this.updateCurrIndex(),this.allSelected(!1)},vt=function(e){e instanceof Row&&(e=this.getIndexByRowId(e.rowId)),this.setRowsUnSelect([e])},pt=function(e){e=We._formatToIndicesArray(this,e);var t=this.selectedIndices().slice();if(-1!=t.indexOf(e[0])){for(var a=0;a<e.length;a++){var n=e[a],s=t.indexOf(n);-1!=s&&t.splice(s,1)}this.selectedIndices(t),this.updatePageSelect();var r=this.getRowIdsByIndices(e);this.trigger(DataTable.ON_ROW_UNSELECT,{indices:e,rowIds:r}),this.updateCurrIndex(),this.allSelected(!1)}},Rt=function(){this.allSelected()?this.setAllRowsUnSelect():this.setAllRowsSelect()},mt=function(e,t,a){Fe(a)||(a=1);var n=this.selectedIndices().slice();if(null!=n&&0!=n.length){for(var s=0,r=n.length;s<r;s++)"+"==t?n[s]>=e&&(n[s]=parseInt(n[s])+a):"-"==t&&(n[s]>=e&&n[s]<=e+a-1?n.splice(s,1):n[s]>e+a-1&&(n[s]=n[s]-a));this.selectedIndices(n),this.updatePageSelect()}},St={setAllRowsSelect:ht,setRowSelect:ct,setRowsSelect:dt,addRowSelect:gt,addRowsSelect:ft,setAllRowsUnSelect:wt,setRowUnSelect:vt,setRowsUnSelect:pt,toggleAllSelect:Rt,updateSelectedIndices:mt},Tt=function(e,t,a){var n=null;e instanceof Row&&(e=this.getIndexByRowId(e.rowId),n=e.rowId),-1===e||e===this.focusIndex()&&!a||(this.focusIndex(e),t||(this.currentRowChange(-this.currentRowChange()),n||(n=this.getRow(e).rowId),this.trigger(DataTable.ON_ROW_FOCUS,{index:e,rowId:n}),this.updateCurrIndex()))},_t=function(){this.currentRowChange(-this.currentRowChange());var e=this.focusIndex(),t=null;-1!==e&&(t=this.getRow(e).rowId),this.trigger(DataTable.ON_ROW_UNFOCUS,{index:e,rowId:t}),this.focusIndex(-1),this.updateCurrIndex()},Ct=function(e,t,a){Fe(a)||(a=1),e<=this.focusIndex()&&-1!=this.focusIndex()&&("+"===t?this.focusIndex(this.focusIndex()+a):"-"===t&&(this.focusIndex()>=e&&this.focusIndex()<=e+a-1?this.focusIndex(-1):this.focusIndex()>e+a-1&&this.focusIndex(this.focusIndex()-a)))},It={setRowFocus:Tt,setRowUnFocus:_t,updateFocusIndex:Ct},bt=function(e,t){if(this.removeAllRows(),this.cachedPages=[],this.focusIndex(-1),this.selectedIndices([]),this.setSimpleDataReal=[],!e)return void(this.setSimpleDataReal=e);var a=[];je(e)||(e=[e]);for(var n=0;n<e.length;n++){var r=e[n];"object"!==s(e[n])&&(r={$data:e[n]}),a.push({status:Row.STATUS.NORMAL,data:r})}var r={rows:a};t&&void 0===t.fieldFlag&&(t.fieldFlag=!0),this.setData(r,t)},Dt=function(e,t,a){if(!e)throw new Error("dataTable.addSimpleData param can't be null!");je(e)||(e=[e]);for(var n=0;n<e.length;n++){this.createEmptyRow(a).setSimpleData(e[n],t)}},Et={setSimpleData:bt,addSimpleData:Dt},yt=function(e,t,a){var n=this,r=t;if("[object Array]"==Object.prototype.toString.call(e)){for(var i in e)this.on(e[i],t);return this}if("object"==(void 0===e?"undefined":s(e))){for(var o in e)this.on(o,e[o]);return this}return a&&(t=function(){n.off(e,t),r.apply(this,arguments)}),e=e.toLowerCase(),this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t}),this},At=function(e,t){if(e=e.toLowerCase(),!this._events)return this;if("[object Array]"==Object.prototype.toString.call(e)){for(var a in e)this.off(e[a],t);return this}if("object"==(void 0===e?"undefined":s(e))){for(var n in e)this.off(n,e[n]);return this}var r=this._events[e];if(!r)return this;if(t)for(var a=r.length-1;a>=0;a--)r[a]==t&&r.splice(a,1);else r=null;return this},Ot=function(e,t){this.on(e,t,1)},xt=function(e){if(e=e.toLowerCase(),!this._events||!this._events[e])return this;for(var t=Array.prototype.slice.call(arguments,1),a=this._events[e],n=0,s=a.length;n<s;n++)a[n].callback.apply(this,t);return this},Nt=function(e){if(e=e.toLowerCase(),!this._events||!this._events[e])return this;for(var t=Array.prototype.slice.call(arguments,1),a=this._events[e],n=!0,s=0,r=a.length;s<r;s++)n=n&&a[s].callback.apply(this,t);return n},Mt=function(e){return e=e.toLowerCase(),this._events||(this._events={}),this._events[e]},Ut={on:yt,off:At,one:Ot,trigger:xt,triggerReturn:Nt,getEvent:Mt},Pt=function e(t){r(this,e),t=t||{},this.id=t.id,this.strict=t.strict||!1,this.meta=e.createMetaItems(t.meta),this.enable=t.enable||e.DEFAULTS.enable,this.pageSize=ko.observable(t.pageSize||e.DEFAULTS.pageSize),this.pageIndex=ko.observable(t.pageIndex||e.DEFAULTS.pageIndex),this.totalPages=ko.observable(t.totalPages||e.DEFAULTS.totalPages),this.totalRow=ko.observable(),this.pageCache=void 0===t.pageCache?e.DEFAULTS.pageCache:t.pageCache,this.rows=ko.observableArray([]),this.selectedIndices=ko.observableArray([]),this._oldCurrentIndex=-1,this.focusIndex=ko.observable(-1),this.cachedPages=[],this.metaChange={},this.valueChange={},this.currentRowChange=ko.observable(1),this.enableChange=ko.observable(1),this.params=t.params||{},this.master=t.master||"",this.allSelected=ko.observable(!1),this.dateNoConvert=t.dateNoConvert||!1,t.root?this.root=t.root:this.root=this,t.ns?this.ns=t.ns:this.ns="",this.newCount=0},Lt=Pt.prototype;Object.assign(Lt,g),Object.assign(Lt,R),Object.assign(Lt,T),Object.assign(Lt,I),Object.assign(Lt,z),Object.assign(Lt,Z),Object.assign(Lt,$),Object.assign(Lt,K),Object.assign(Lt,te),Object.assign(Lt,oe),Object.assign(Lt,ue),Object.assign(Lt,be),Object.assign(Lt,ge),Object.assign(Lt,Ue),Object.assign(Lt,ye),Object.assign(Lt,nt),Object.assign(Lt,qe),Object.assign(Lt,rt),Object.assign(Lt,Et),Object.assign(Lt,It),Object.assign(Lt,Ut),Object.assign(Lt,We),Object.assign(Lt,St),Object.assign(Lt,ut),Pt.DEFAULTS={pageSize:20,pageIndex:0,totalPages:0,pageCache:!1,enable:!0},Pt.META_DEFAULTS={enable:!0,required:!1,descs:{}},Pt.ON_ROW_SELECT="select",Pt.ON_ROW_UNSELECT="unSelect",Pt.ON_ROW_ALLSELECT="allSelect",Pt.ON_ROW_ALLUNSELECT="allUnselect",Pt.ON_VALUE_CHANGE="valueChange",Pt.ON_BEFORE_VALUE_CHANGE="beforeValueCHange",Pt.ON_CURRENT_VALUE_CHANGE="currentValueChange",Pt.ON_INSERT="insert",Pt.ON_UPDATE="update",Pt.ON_CURRENT_UPDATE="currentUpdate",Pt.ON_DELETE="delete",Pt.ON_DELETE_ALL="deleteAll",Pt.ON_ROW_FOCUS="focus",Pt.ON_ROW_UNFOCUS="unFocus",Pt.ON_LOAD="load",Pt.ON_ENABLE_CHANGE="enableChange",Pt.ON_META_CHANGE="metaChange",Pt.ON_ROW_META_CHANGE="rowMetaChange",Pt.ON_CURRENT_META_CHANGE="currentMetaChange",Pt.ON_CURRENT_ROW_CHANGE="currentRowChange",Pt.SUBMIT={current:"current",focus:"focus",all:"all",select:"select",change:"change",empty:"empty",allSelect:"allSelect",allPages:"allPages"},Pt.createMetaItems=function(e){var t={};for(var a in e){var n=e[a];"string"==typeof n&&(n={}),t[a]=h({},Pt.META_DEFAULTS,n)}return t};var Ft=function(e,t,a){var n=this.rows[e];n&&(n.data[t].value=a,n.status!=Row.STATUS.NEW&&n.setStatus(Row.STATUS.UPDATE))},jt=function(e,t){if(t.data)for(var a in t.data)if(e.data[a]){var n=t.data[a];if("string"==typeof n||"number"==typeof n||null===n)e.data[a].value=n;else if(n.error)u.showMessageDialog?u.showMessageDialog({title:"警告",msg:n.error,backdrop:!0}):alert(n.error);else{e.data[a].value=n.value;for(var s in n.meta)e.data[a].meta=e.data[a].meta||{},e.data[a].meta[s]=n.meta[s]}}},kt={setRowValue:Ft,updateRow:jt},Vt=function(){var e,t=[];this.parent.getMeta();for(var a=0;a<this.rows.length;a++)e=this.rows[a],t.push({id:e.rowId,status:e.status,data:e.data});return t},Bt=function(){for(var e,t=[],a=0;a<this.rows.length;a++)e=this.rows[a],t.push({id:e.rowId,status:e.status,data:e.data});for(var a=0;a<this.selectedIndices.length;a++)e=this.rows[this.selectedIndices[a]],t.push({id:e.rowId,status:e.status,data:e.data});return t},Ht=function(){for(var e=[],t=0;t<this.selectedIndices.length;t++)e.push(this.rows[this.selectedIndices[t]]);return e},Wt=function(e){for(var t=0,a=this.rows.length;t<a;t++)if(this.rows[t].rowId==e)return this.rows[t];return null},zt=function(e,t){var a=this.rows[e];return a?a.data[t].value:null},Yt={getData:Vt,getSelectDatas:Bt,getSelectRows:Ht,getRowByRowId:Wt,getRowValue:zt},Gt=function(e,t,a){var n=this.rows[e];if(n){var s=n[t].meta;return s?s[a]:null}return null},Zt={getRowMeta:Gt},Jt=function(e,t,a,n){var s=this.rows[e];if(s){var r=s[t].meta;r||(r=s[t].meta={}),r[a]=n,s.status!=Row.STATUS.NEW&&s.setStatus(Row.STATUS.UPDATE)}},qt={setRowMeta:Jt},$t=function(e){for(var t=0,a=this.rows.length;t<a;t++)this.rows[t].rowId==e&&(this.rows.splice(t,1),a--,this.updateSelectedIndices(t,"-"),this.updateFocusIndex(t,"-"))},Xt=function(e,t,a){Fe(a)||(a=1);var n=this.selectedIndices.slice();if(null!=n&&0!=n.length){for(var s=0,r=n.length;s<r;s++)"+"==t?n[s]>=e&&(n[s]=parseInt(n[s])+a):"-"==t&&(n[s]>=e&&n[s]<=e+a-1?n.splice(s,1):n[s]>e+a-1&&(n[s]=n[s]-a));this.selectedIndices=n}},Qt=function(e,t,a){Fe(a)||(a=1),e<=this.focus&&-1!=this.focus&&("+"===t?this.focus=this.focus+a:"-"===t&&(this.focus>=e&&this.focus<=e+a-1?this.focus=this.focus-1:this.focus>e+a-1&&(this.focus=this.focus-a)))},Kt={removeRowByRowId:$t,updateSelectedIndices:Xt,updateFocusIndex:Qt},ea=function e(t){r(this,e),this.focus=t.focus||null,this.selectedIndices=t.selectedIndices||null,this.rows=t.rows||[],this.parent=t.parent||null},ta=ea.prototype;Object.assign(ta,kt),Object.assign(ta,Yt),Object.assign(ta,Zt),Object.assign(ta,qt),Object.assign(ta,Kt);var aa=function e(){r(this,e)},na=aa.prototype;Object.assign(na,Ut);var sa=function(e,t){return!(null!==e&&void 0!==e&&""!==e||null!==t&&void 0!==t&&""!==t)||e+""==t+""},ra=function(e){if(!e)return e;var t=new Date;if(t.setTime(e),isNaN(t))return e;var a=t.getFullYear(),n=t.getMonth()+1;parseInt(n)<10&&(n="0"+n);var s=t.getDate();parseInt(s)<10&&(s="0"+s);var r=t.getHours();parseInt(r)<10&&(r="0"+r);var i=t.getMinutes();parseInt(i)<10&&(i="0"+i);var o=t.getSeconds();parseInt(o)<10&&(o="0"+o)
;t.getMilliseconds();return a+"-"+n+"-"+s+" "+r+":"+i+":"+o},ia=function(e){if(!e&&0!=e)return"";if("number"==typeof e)return e;e.indexOf("-")>-1&&(e=e.replace(/\-/g,"/"));var t=Date.parse(e);return isNaN(t)?"":t},oa=function(e,t,a,n){if(ha(e,t).changed=!0,e.status!=Row.STATUS.NEW&&e.setStatus(Row.STATUS.UPDATE),e.valueChange[t]&&e.valueChange[t](-e.valueChange[t]()),e.parent.getCurrentRow()==e&&e.parent.valueChange[t]&&e.parent.valueChange[t](-e.parent.valueChange[t]()),e.parent.ns){var s=e.parent.ns+"."+t;e.parent.root.valueChange[s]&&e.parent.root.valueChange[s](-e.parent.root.valueChange[s]())}var r={eventType:"dataTableEvent",dataTable:e.parent.id,rowId:e.rowId,field:t,oldValue:a,newValue:e.getValue(t),ctx:n||"",rowObj:e};e.parent.trigger(DataTable.ON_VALUE_CHANGE,r),e.parent.trigger(t+"."+DataTable.ON_VALUE_CHANGE,r),e==e.parent.getCurrentRow()&&e.parent.trigger(t+"."+DataTable.ON_CURRENT_VALUE_CHANGE,r),e.parent.ns&&(r.fullField=s,r.ns=e.parent.ns,e.parent.root.trigger(DataTable.ON_VALUE_CHANGE,r),e.parent.root.trigger(s+"."+DataTable.ON_VALUE_CHANGE,r))},la=function(e,t){var a=this.parent.getMeta(e,"type");return a&&("date"==a||"datetime"==a)?ra(t):t},ua=function(e,t){var a=e.data[t];if(!a){var n=t.split(".");if(n.length>1){for(var s=e.data,r=0;r<n.length;r++){if(s=s[n[r]],s.value instanceof DataTable){var i=s.value.getCurrentRow();i||(i=s.value.rows()[0]),i&&(s=i.data)}if(!s)break}a=s}}return a||null},ha=function(e,t){var a=ua(e,t);if(!a){var n="field:"+t+" not exist in dataTable:"+e.parent.root.id+"!";throw new Error(n)}return a},ca={formatValue:la,eq:sa,_triggerChange:oa,_getField:ha,_dateToUTCString:ia},da=function(e,t,a,n){1===arguments.length&&(t=e,e="$data");var s=this.getValue(e);if(void 0!==s&&null!==s||(s=""),!ca.eq(s,t)){var r={eventType:"dataTableEvent",dataTable:this.parent.id,rowId:this.rowId,field:e,oldValue:s,newValue:t,ctx:a||""};if(!this.parent.triggerReturn(DataTable.ON_BEFORE_VALUE_CHANGE,r))return void ca._triggerChange(this,e,s,a);ca._getField(this,e).value=t,ca._triggerChange(this,e,s,a)}},ga=function(e,t){for(var a=e.split("."),n=a[0],s=this.data[n],r=0,i=a.length;r<i;r++)if(r==i-1)s.value instanceof u.DataTable||this.setValue(e,t);else if(s&&s.value instanceof u.DataTable){var o=s.value.getCurrentRow();o&&o.setChildValue(e.replace(n+".",""),t)}else n=a[r+1],s=s[n]},fa=function(e,t){var a=e.split(".");if(a.length>1){var n=a[0],s=this.data[n];if(s&&s.value instanceof u.DataTable){var e=a[1],r=null;e&&(r=s.value.getRowByRowId(e)),r&&(2==a.length?r.setSimpleData(t):r.setChildSimpleDataByRowId(fieldName.replace(n+"."+e+".",""),t))}}},wa=function e(t,a,n,r,i,o){for(var l in a)if(!o||o.fieldFlag||t.parent.getMeta(l)){var h=i||null;n[l]=n[l]||{};var c=a[l];if(null==c||"object"!=(void 0===c?"undefined":s(c)))n[l].isChild||(n[l].value=t.formatValue(l,c)),!0===r&&d!==n[l].value&&ca._triggerChange(t,l,d);else if(c.error)u.showMessageDialog?u.showMessageDialog({title:"警告",msg:c.error,backdrop:!0}):alert(c.error);else if(c.value||null===c.value||c.meta||""===c.value||"0"===c.value||0===c.value){var d=n[l].value;n[l].value=t.formatValue(l,c.value),!0===r&&d!==n[l].value&&ca._triggerChange(t,l,d);for(var g in c.meta)t.setMeta(l,g,c.meta[g])}else if(je(c)){n[l].isChild=!0;var f=null==h?l:h+"."+l,w=""===t.parent.ns?l:t.parent.ns+"."+f;if(t.parent.meta[f]){var v=t.parent.meta[f].meta;n[l].value=new u.DataTable({root:t.parent.root,ns:w,meta:v}),n[l].value.setSimpleData(c)}}else h=null==h?l:h+"."+l,e(t,c,n[l],null,h,o)}},va=function(e,t,a){var n=e.data,r=this.data;if(1!=this.parent.root.strict)return wa(this,n,r,t,null,a),void this.setStatus(e.status);var i=this.parent.meta;for(var o in i){var l=newValue=null;if(i[o].type&&"child"===i[o].type){r[o].isChild=!0;var h=""===this.parent.ns?o:this.parent.ns+"."+o,i=this.parent.meta[o].meta;r[o].value=new u.DataTable({root:this.parent.root,ns:h,meta:i}),"object"===s(n[o])&&r[o].value.setSimpleData(n[o])}else if(-1!=o.indexOf(".")){for(var c=o.split("."),d=n,g=r,f=0;f<c.length;f++)d=d||{},d=d[c[f]],g=g[c[f]];l=g.value,g.value=this.formatValue(o,d),newValue=g.value}else if(null==n[o]||"object"!=s(n[o]))l=r[o].value,r[o].value=this.formatValue(o,n[o]),newValue=r[o].value;else{var w=n[o];if(w.error)u.showMessageDialog?u.showMessageDialog({title:"警告",msg:w.error,backdrop:!0}):alert(w.error);else if(w.value||null===w.value||w.meta){l=r[o].value,r[o].value=this.formatValue(o,w.value),newValue=r[o].value;for(var v in w.meta)this.setMeta(o,v,w.meta[v])}}!0===t&&l!==newValue&&ca._triggerChange(this,o,l)}},pa=function(e){this.setData(e)},Ra=function(e){if(this.status=e,e==Row.STATUS.NORMAL){var t=this.data;for(var a in t){var n=t[a].value;t[a].baseValue=n}}},ma=function(){var e=this.data;for(var t in e){var a=e[t].baseValue;this.setValue(t,a)}},Sa={setValue:da,setChildValue:ga,setChildSimpleDataByRowId:fa,setData:va,updateRow:pa,setStatus:Ra,resetValue:ma},Ta=function(e){return ca._getField(this,e).value},_a=function(e){for(var t=e.split("."),a=t[0],n=0,s=t.length;n<s;n++){var r=this.getValue(a);if(n==s-1)return r instanceof u.DataTable?r.rows.peek():r;if(r instanceof u.DataTable)return r=r.getCurrentRow(),r?r.getChildValue(e.replace(a+".","")):"";a=a+"."+t[n+1]}return""},Ca=function(){var e=ko.toJS(this.data),t=this.parent.getMeta();for(var a in t)if(t[a]&&t[a].type)if("date"==t[a].type||"datetime"==t[a].type)if(a.indexOf(".")>0){for(var n=a.split("."),s=e,r=0,i=n.length;r<i;r++)s=s[n[r]];s.value=ca._dateToUTCString(s.value)}else e[a].value=ca._dateToUTCString(e[a].value);else if("child"==t[a].type){for(var o=this.getValue(a),l=o.rows(),u=[],r=0;r<l.length;r++)u.push(l[r].getData());e[a].value=JSON.stringify(u)}return{id:this.rowId,status:this.status,data:e}},Ia=function(){return{id:this.rowId,status:this.status,data:{}}},ba={getValue:Ta,getChildValue:_a,getData:Ca,getEmptyData:Ia},Da=function(e,t,a){if(0==arguments.length){var n={};for(var s in this.data)n[s]=this.data[s].meta?this.data[s].meta:{};return n}var r=ca._getField(this,e).meta;return r&&void 0!==r[t]&&null!==r[t]&&""!==r[t]?r[t]:void 0===a||0!=a?this.parent.getMeta(e,t):void 0},Ea={getMeta:Da},ya=function e(t,a){var n={},s=t.parent.getMeta()||{};for(var r in a)if("meta"!==r&&!ke(a[r]))if(a[r].isChild)n[r]=a[r].value?a[r].value.getSimpleData():{};else if("$data"===r)n=a[r].value;else if(void 0!==a[r].value){if(s[r]&&"boolean"===s[r].type?n[r]=!!a[r].value:n[r]=a[r].value,s[r]&&s[r].type){var i={meta:s,data:a,key:r};n[r]=t.formatValueFun(i,t.parent.dateNoConvert)}}else a[r].value?n[r]=e(t,a[r]):n[r]=a[r].value;return n},Aa=function(e,t){var a=e.meta,n=e.data,s=e.key;return t||"date"!=a[s].type&&"datetime"!=a[s].type?n[s].value:ca._dateToUTCString(n[s].value)},Oa=function(e){e=e||{};var t=e.fields||null,a=(this.parent.getMeta(),this.data),n=ya(this,a),s={};if(t){for(var r in n)-1!=t.indexOf(r)&&(s[r]=n[r]);return s}return n},xa={formatValueFun:Aa,getSimpleData:Oa},Na=function(){var e=this.parent.meta;for(var t in e){var a;if(t.indexOf(".")>0){var n=t.split(".");a=this.data[n[0]]=this.data[n[0]]||{};for(var r=1;r<n.length;r++)a[n[r]]=a[n[r]]||{},a=a[n[r]]}else this.data[t]=this.data[t]||{},a=this.data[t];if(a.value=null,e[t].type&&"child"===e[t].type){a.isChild=!0;var i=""===this.parent.ns?t:this.parent.ns+"."+t;a.value=new u.DataTable({root:this.parent.root,ns:i,meta:e[t].meta})}else if(e[t].default){var o=e[t].default;if("object"===(void 0===o?"undefined":s(o)))for(var l in o)"value"==l?"function"==typeof o[l]?a.value=this.formatValue(t,o[l]()):a.value=this.formatValue(t,o[l]):(a.meta=a.meta||{},a.meta[l]=o[l]);else a.value="function"==typeof o?this.formatValue(t,o()):this.formatValue(t,o)}}},Ma={init:Na},Ua=function(e,t,a){var n=ca._getField(this,e).meta;n||(n=ca._getField(this,e).meta={});var s=n[t];ca.eq(s,a)||(n[t]=a,this.metaChange[e+"."+t]&&this.metaChange[e+"."+t](-this.metaChange[e+"."+t]()),"enable"==t&&this.parent.enableChange(-this.parent.enableChange()),this.parent.getCurrentRow()==this&&(this.parent.metaChange[e+"."+t]&&this.parent.metaChange[e+"."+t](-this.parent.metaChange[e+"."+t]()),this.parent.trigger(e+"."+t+"."+DataTable.ON_CURRENT_META_CHANGE,{eventType:"dataTableEvent",dataTable:this.parent.id,oldValue:s,newValue:a})),this.parent.trigger(DataTable.ON_ROW_META_CHANGE,{eventType:"dataTableEvent",dataTable:this.parent.id,field:e,meta:t,oldValue:s,newValue:a,row:this}),this.parent.trigger(e+"."+t+"."+DataTable.ON_ROW_META_CHANGE,{eventType:"dataTableEvent",dataTable:this.parent.id,field:e,meta:t,oldValue:s,newValue:a,row:this}))},Pa={setMeta:Ua},La=function(e,t,a,n,s,r){var i=e+"="+encodeURIComponent(t);a&&(i+="; expires="+a.toGMTString()),n&&(i+="; path="+n),s&&(i+="; domain="+s),r&&(i+="; secure="+r),document.cookie=i},Fa=function(e){var t="(?:; )?"+e+"=([^;]*);?";return new RegExp(t).test(document.cookie)?decodeURIComponent(RegExp.$1):null},ja={},ka={},Va={},Ba={},Ha={float:{precision:2},datetime:{format:"YYYY-MM-DD HH:mm:ss",metaType:"DateTimeFormatMeta",speratorSymbol:"-"},time:{format:"HH:mm"},date:{format:"YYYY-MM-DD"},currency:{precision:2,curSymbol:"￥"},percent:{},phoneNumber:{}};Ba.getEnvironment=function(){return Pe(ja)},Ba.getClientAttributes=function(){return Pe(ka)},Ba.setContextPath=function(e){return ja[IWEB_CONTEXT_PATH]=e},Ba.getContextPath=function(e){return ja[IWEB_CONTEXT_PATH]},Ba.setClientAttribute=function(e,t){ka[e]=t},Ba.getSessionAttributes=function(){return Pe(Va)},Ba.setSessionAttribute=function(e,t){Va[e]=t,La("ISES_"+e,t)},Ba.removeClientAttribute=function(e){ka[e]=null,execIgnoreError(function(){delete ka[e]})},Ba.getLocale=function(){return this.getEnvironment().locale},Ba.getLanguages=function(){return this.getEnvironment().languages},Ba.collectEnvironment=function(){var e=this.getEnvironment(),t=this.getSessionAttributes();for(var a in ka)t[a]=ka[a];return e.clientAttributes=t,e},Ba.setMaskerMeta=function(e,t){if("function"==typeof e)getMetaFunc=e;else if(Ha[e])if("object"!=(void 0===t?"undefined":s(t)))Ha[e]=t;else for(var a in t)Ha[e][a]=t[a];else Ha[e]=t},Ba.getMaskerMeta=function(e){if("function"==typeof getMetaFunc){return getMetaFunc.call(this)[e]}return h({},Ha[e])},ja.languages=Fa("i_languages")?Fa("i_languages").split(","):navigator.language?navigator.language:"zh-CN","zh-cn"==ja.languages&&(ja.languages="zh-CN"),"en-us"==ja.languages&&(ja.languages="en-US"),ja.theme=Fa("u_theme"),ja.locale=Fa("u_locale"),ja.usercode=Fa("usercode"),document.cookie.replace(/ISES_(\w*)=([^;]*);?/gi,function(e,t,a){Va[t]=a});var Wa=function(){};Wa.prototype=Ba;var za=new Wa;if(window.getCurrentJsPath=function(){var e=document,t={},a=+new Date,n=/((?:http|https|file):\/\/.*?\/[^:]+)(?::\d+)?:\d+/,s=-1===(""+e.querySelector).indexOf("[native code]");if(e.currentScript)return e.currentScript.src;var r;try{t.b()}catch(e){r=e.stack||e.fileName||e.sourceURL||e.stacktrace}if(r){var i=n.exec(r)[1];if(i)return i}for(var o,l=e.scripts,u=l.length-1;o=l[u--];)if(o.className!==a&&"interactive"===o.readyState)return o.className=a,s?o.getAttribute("src",4):o.src},window.i18n){window.u=window.u||{};var Ya=getCurrentJsPath(),Ga=Ya.substr(0,Ya.lastIndexOf("/")),Za=Ga.substr(0,Ga.lastIndexOf("/")),Ja=u.i18nPath||Za+"/locales/__lng__/__ns__.json";i18n.init({postAsync:!1,getAsync:!1,fallbackLng:!1,ns:{namespaces:["uui-trans"]},lng:Fa("u_locale")||"zh",resGetPath:Ja})}var qa=function(e,t){return window.i18n?i18n.t("uui-trans:"+e):t},$a={};$a.date={_dateLocale:{"zh-CN":{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_")},"en-US":{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thurday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"S_M_T_W_T_F_S".split("_")}},_jsonLocale:{months:qa("date.months","一月\n二月\n三月\n四月\n五月\n六月\n七月\n八月\n九月\n十月\n十一月\n十二月").split("\n"),monthsShort:qa("date.monthsShort","1月\n2月\n3月\n4月\n5月\n6月\n7月\n8月\n9月\n10月\n11月\n12月").split("\n"),weekdays:qa("date.weekdays","星期日\n星期一\n星期二\n星期三\n星期四\n星期五\n星期六").split("\n"),weekdaysShort:qa("date.weekdaysShort","周日\n周一\n周二\n周三\n周四\n周五\n周六").split("\n"),weekdaysMin:qa("date.weekdaysMin","日\n一\n二\n三\n四\n五\n六").split("\n"),defaultMonth:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},_formattingTokens:/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYY|YY|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,leftZeroFill:function(e,t,a){for(var n=""+Math.abs(e),s=e>=0;n.length<t;)n="0"+n;return(s?a?"+":"":"-")+n},_formats:{YY:function(e){return $a.date.leftZeroFill(e.getFullYear()%100,2)},YYYY:function(e){return e.getFullYear()},M:function(e){return e.getMonth()+1},MM:function(e){var t=$a.date._formats.M(e);return $a.date.leftZeroFill(t,2)},MMM:function(e,t){var a=e.getMonth();return $a.date._jsonLocale.monthsShort[a]},MMMM:function(e,t){var a=e.getMonth();return $a.date._jsonLocale.months[a]},D:function(e){return e.getDate()},DD:function(e){var t=$a.date._formats.D(e);return $a.date.leftZeroFill(t,2)},d:function(e){return e.getDay()},dd:function(e,t){var a=$a.date._formats.d(e);return $a.date._jsonLocale.weekdaysMin[a]},ddd:function(e,t){var a=$a.date._formats.d(e);return $a.date._jsonLocale.weekdaysShort[a]},dddd:function(e,t){var a=$a.date._formats.d(e);return $a.date._jsonLocale.weekdays[a]},a:function(e){return e.getHours()>12?"pm":"am"},h:function(e){var t=e.getHours();return t=t>12?t-12:t,t},hh:function(e){var t=$a.date._formats.h(e);return $a.date.leftZeroFill(t,2)},H:function(e){return e.getHours()},HH:function(e){return $a.date.leftZeroFill(e.getHours(),2)},m:function(e){return e.getMinutes()},mm:function(e){return $a.date.leftZeroFill(e.getMinutes(),2)},s:function(e){return e.getSeconds()},ss:function(e){return $a.date.leftZeroFill(e.getSeconds(),2)}},format:function(e,t,a){if(!e&&0!=e)return"";var n,s,r=t.match($a.date._formattingTokens),i="",o=$a.date.getDateObj(e);if(!o)return e;for(a=a||za.getLanguages(),n=0,s=r.length;n<s;n++)$a.date._formats[r[n]]?i+=$a.date._formats[r[n]](o,a):i+=r[n];return i},strToDateByTimezone:function(e,t){var a=$a.date.getDateObj(e),n=a.getTime(),s=6e4*a.getTimezoneOffset(),r=n+s;return r+=36e5*parseFloat(t)},getDateByTimeZonec2z:function(e,t){var a=$a.date.getDateObj(e),n=a.getTime(),s=6e4*a.getTimezoneOffset(),r=n+s,i=r+36e5*parseFloat(t);return new Date(i)},getDateByTimeZonez2c:function(e,t){var a=$a.date.getDateObj(e),n=a.getTime(),s=6e4*a.getTimezoneOffset(),r=n-36e5*parseFloat(t)-s;return new Date(r)},_addOrSubtract:function(e,t,a,n){var s=e.getTime(),r=e.getDate(),i=e.getMonth(),o=$a.date.getDateObj(e);return"ms"===t?(s+=a*n,o.setTime(s)):"s"==t?(s+=1e3*a*n,o.setTime(s)):"m"==t?(s+=6e4*a*n,o.setTime(s)):"h"==t?(s+=36e5*a*n,o.setTime(s)):"d"==t?(r+=a*n,o.setDate(r)):"w"==t?(r+=7*a*n,o.setDate(r)):"M"==t?(i+=a*n,o.setMonth(i)):"y"==t&&(i+=12*a*n,o.setMonth(i)),o},add:function(e,t,a){return $a.date._addOrSubtract(e,t,a,1)},sub:function(e,t,a){return $a.date._addOrSubtract(e,t,a,-1)},getDateObj:function(e,t){var a;if(t&&(a=t.timezone),!e&&0!=e||void 0===e)return e;var n=!1,s=new Date(Ve(e));if(isNaN(s)){var r,i,o,l,u,h,c;e.indexOf&&(r=e.indexOf("-"),i=e.indexOf(":"),o=e.indexOf(" "),r>0||i>0||o>0?(s=new Date,o>0?(h=e.split(" "),l=h[0].split("-"),u=h[1].split(":"),c=h[2]):r>0?l=e.split("-"):i>0&&(u=e.split(":")),l&&l.length>0&&(s.setYear(l[0]),s.setMonth(parseInt(l[1]-1)),s.setDate(l[2]?l[2]:0),s.setMonth(parseInt(l[1]-1)),s.setDate(l[2]?l[2]:0),n=!0),u&&u.length>0&&("pm"==c&&(u[0]=u[0]- -12),s.setHours(u[0]?u[0]:0),s.setMinutes(u[1]?u[1]:0),s.setSeconds(u[2]?u[2]:0),n=!0)):(s=new Date(parseInt(e)),isNaN(s)||(n=!0)))}else n=!0;return n?(a&&(s=$a.date.getDateByTimeZonec2z(s,a)),s):null}};var Xa=$a.date,Qa=function(e){return this.parent.createField(e),this.valueChange[e]||(this.valueChange[e]=ko.observable(1)),ko.pureComputed({read:function(){return this.valueChange[e](),this.currentRowChange(),this.getChildValue(e)},write:function(t){this.setChildValue(e,t)},owner:this})},Ka=function(e,t){return this.metaChange[e+"."+t]||(this.metaChange[e+"."+t]=ko.observable(1)),ko.pureComputed({read:function(){return this.metaChange[e+"."+t](),this.getMeta(e,t)},write:function(a){this.setMeta(e,t,a)},owner:this})},en=function(e,t){return this.valueChange[e]||(this.valueChange[e]=ko.observable(1)),ko.pureComputed({read:function(){this.valueChange[e](),this.currentRowChange();var a=Le(this.parent.parent,t);if(void 0===ca._getField(this,e).value||""===ca._getField(this,e).value)return"";for(var n=ca._getField(this,e).value,s="string"==typeof n?n.split(","):[n],r=[],i=0,o=a.length;i<o;i++)for(var l=0;l<s.length;l++){var u=a[i].pk||a[i].value||"";u==s[l]&&r.push(a[i].name)}return r.toString()},write:function(t){this.setValue(e,t)},owner:this})},tn=function(e,t){return this.valueChange[e]||(this.valueChange[e]=ko.observable(1)),ko.pureComputed({read:function(){if(this.valueChange[e](),this.currentRowChange(),!ca._getField(this,e).value)return"";var a=ca._getField(this,e).value;return a?a=Xa.format(a,t):""},write:function(t){this.setValue(e,t)},owner:this})},an=function(e){return this.parent.createField(e),this.valueChange[e]||(this.valueChange[e]=ko.observable(1)),ko.pureComputed({read:function(){if(this.valueChange[e](),this.currentRowChange(),!ca._getField(this,e).value)return"";var t=ca._getField(this,e).value;return t?("N"==t?t="否":"Y"==t&&(t="是"),t):""},write:function(t){this.setValue(e,t)},owner:this})},nn={ref:Qa,refMeta:Ka,refCombo:en,refDate:tn,refEnum:an},sn=function(e){var t=this.parent.getRowIndex(this);-1!=this.parent.getSelectedIndices().indexOf(t)?this.parent.setRowUnSelect(t):"single"===e?this.parent.setRowSelect(t):this.parent.addRowSelect(t)},rn=function(){this.toggleSelect("single")},on=function(){this.toggleSelect("multi")},ln={toggleSelect:sn,singleSelect:rn,multiSelect:on},un=function(e,t){var a={};a.data=e,a.status=t||"nrm",this.setData(a,!0),this.currentRowChange(-this.currentRowChange())},hn={setSimpleData:un},cn=function(e){function t(e){r(this,t);var a=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.rowId=e.id||t.getRandomRowId(),a.status=t.STATUS.NEW,a.parent=e.parent,a.data={},a.metaChange={},a.valueChange={},a.currentRowChange=ko.observable(1),a.selected=ko.pureComputed({read:function(){var e=this.parent.getRowIndex(this);return-1!=this.parent.getSelectedIndices().indexOf(e)},owner:a}),a.focused=ko.pureComputed({read:function(){var e=this.parent.getRowIndex(this);return this.parent.getFocusIndex()==e},owner:a}),a.init(),a}return o(t,e),t}(aa),dn=cn.prototype;Object.assign(dn,Sa),Object.assign(dn,ba),Object.assign(dn,Ea),Object.assign(dn,xa),Object.assign(dn,Ma),Object.assign(dn,Pa),Object.assign(dn,nn),Object.assign(dn,ln),Object.assign(dn,hn),Object.assign(dn,ca),cn.STATUS={NORMAL:"nrm",UPDATE:"upd",NEW:"new",DELETE:"del",FALSE_DELETE:"fdel"},cn.getRandomRowId=function(){return setTimeout(function(){})+""},window.DataTable=Pt,window.Page=ea,window.Row=cn,window.u=window.u||{},u=window.u,u.DataTable=Pt,u.Row=cn,e.u=u,e.DataTable=Pt}(this.bar=this.bar||{});
